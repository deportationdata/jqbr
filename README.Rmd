---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# qbr

<!-- badges: start -->
![stability-wip](https://img.shields.io/badge/stability-work_in_progress-lightgrey.svg)
[![R-CMD-check](https://github.com/hfshr/qbr/workflows/R-CMD-check/badge.svg)](https://github.com/hfshr/qbr/actions)
<!-- badges: end -->

htmlwidget for jQuery QueryBuilder. The goal is to build upon the great work done by [\@harveyl888](https://github.com/harveyl888) with [queryBuilder](https://github.com/harveyl888/queryBuilder)  and provide support for all plugins and widgets shown on https://querybuilder.js.org/demo.html.

# Installation

```{r eval = FALSE}
# install.packages("remotes")
remotes::install_github("hfshr/qbr")
```

# Useage

See the demo here: https://harryfish.shinyapps.io/qbr_demo

Start by creating a list of filters to be used with your data. The `id` should be one of the column names within the data you want to filter. For example, here are two filters that could be used with the `palmerpenguins::penguins` data set. You can also optionally specify a range of different options for each filter input, a few have been shown below:

```{r}
filters <- list(
  list(
    id = "species",
    label = "Species",
    type = "string",
    input = "select",
    description = "Shift-click to select multiple!",
    values = list(
      "Adelie",
      "Gentoo",
      "Chinstrap"
    ),
    multiple = TRUE,
    operators = c("equal", "not_equal", "in")
  ),
  list(
    id = "sex",
    label = "Sex",
    input = "checkbox",
    values = list(
      "male",
      "female"
    )
  )
)
```

There are a wide range of filter options, see the full list here: https://querybuilder.js.org/#filters

# shiny

Within a shiny app, you can access several outputs generated by the widget by combining the widget id and the required output. For example for a widget called with `qbr::queryBuilderOutput('qbr')` you could use:

* `input$qbr_validate`: result of jQuery QueryBuilder's validate method.
* `input$qbr_out`: result of jQuery QueryBuilder's getRules method. Returns a list containing inputs from the query.
* `input$qbr_sql`: result of jQuery QueryBuilder's getSQL method. Returns a SQL query string.

`qbr` borrows the `filterTable()` function from [\@harveyl888](https://github.com/harveyl888)'s `queryBuilder` to filter a given dataframe. `qbr::filterTable(input$qbr_out, data, 'table')` returns a filtered data frame using the output from the widget and `qbr::filterTable(input$qbr_out, data, 'text')` returns a string containing the filter condition. `qbr::filterTable()` also adds a `date_format` argument for specifying the date format - useful when the datepicker plugin is used.

# Additional features

In theory, anything you see on https://querybuilder.js.org/ should be possible, so check the documentation there to see what is possible and feel free to open an issue if something doesn't work as intended! 

# Related work

* https://github.com/harveyl888/queryBuilder
* https://github.com/Yannael/queryBuildR
